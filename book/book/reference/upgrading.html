<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Upgrade Guides - Perl LSP Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Comprehensive documentation for the perl-lsp project - a production-ready Perl Language Server Protocol implementation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Perl LSP Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/EffortlessMetrics/tree-sitter-perl-rs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="upgrading-to-perl-lsp-v10"><a class="header" href="#upgrading-to-perl-lsp-v10">Upgrading to perl-lsp v1.0</a></h1>
<p>This guide provides comprehensive upgrade instructions from v0.8.x to v1.0.</p>
<p><strong>Quick Summary:</strong></p>
<ul>
<li><strong>MSRV bumped</strong>: Rust 1.89+ required (was 1.89+ in v0.8.x, unchanged)</li>
<li><strong>Rust Edition</strong>: Rust 2024 Edition (was 2021 in v0.8.x)</li>
<li><strong>Breaking Changes</strong>: Minimal - primarily internal API refinements</li>
<li><strong>New Features</strong>: Semantic analyzer, refactoring engine, performance optimizations</li>
<li><strong>Security Hardening</strong>: Path traversal and command injection protections</li>
</ul>
<hr />
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ol>
<li><a href="#breaking-changes">Breaking Changes</a></li>
<li><a href="#new-features">New Features</a></li>
<li><a href="#performance-improvements">Performance Improvements</a></li>
<li><a href="#security-enhancements">Security Enhancements</a></li>
<li><a href="#deprecated-features">Deprecated Features</a></li>
<li><a href="#migration-steps">Migration Steps</a></li>
<li><a href="#lsp-client-changes">LSP Client Changes</a></li>
<li><a href="#library-api-changes">Library API Changes</a></li>
<li><a href="#vs-code-extension-changes">VS Code Extension Changes</a></li>
<li><a href="#dap-changes">DAP Changes</a></li>
<li><a href="#testing-changes">Testing Changes</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ol>
<hr />
<h2 id="breaking-changes"><a class="header" href="#breaking-changes">Breaking Changes</a></h2>
<h3 id="1-rust-2024-edition-pr-175"><a class="header" href="#1-rust-2024-edition-pr-175">1. Rust 2024 Edition (PR #175)</a></h3>
<p><strong>Impact:</strong> All crates now use Rust 2024 Edition</p>
<p><strong>Action Required:</strong></p>
<pre><code class="language-toml"># Update your Cargo.toml if depending on perl-lsp crates
[package]
edition = "2024"
rust-version = "1.89"
</code></pre>
<p><strong>Implications:</strong></p>
<ul>
<li>Edition 2024 introduces new keyword reservations and syntax changes</li>
<li>See <a href="https://doc.rust-lang.org/edition-guide/rust-2024/">Rust Edition Guide</a> for migration details</li>
<li>All perl-lsp crates are compatible with edition 2024 consumers</li>
</ul>
<h3 id="2-strict-error-handling-issue-143-292"><a class="header" href="#2-strict-error-handling-issue-143-292">2. Strict Error Handling (Issue #143, #292)</a></h3>
<p><strong>Impact:</strong> APIs that previously panicked now return <code>Result</code> types</p>
<p><strong>Before (v0.8.x):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Could panic on malformed input
let ast = parser.parse_unchecked(source);
<span class="boring">}</span></code></pre></pre>
<p><strong>After (v1.0):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Returns Result for safe error handling
let ast = parser.parse(source)?;
<span class="boring">}</span></code></pre></pre>
<p><strong>Action Required:</strong></p>
<ul>
<li>Replace <code>.unwrap()</code> and <code>.expect()</code> calls with proper error handling</li>
<li>Use <code>?</code> operator or <code>match</code> for Result types</li>
<li>Review code for panic-prone operations</li>
</ul>
<p><strong>Affected APIs:</strong></p>
<ul>
<li>Parser core: All parsing methods now return <code>Result&lt;Node, ParseError&gt;</code></li>
<li>LSP handlers: Internal handlers use <code>Result</code> for error propagation</li>
<li>Lexer: Tokenization methods return <code>Result</code> for malformed input</li>
</ul>
<h3 id="3-vs-code-extension-configuration"><a class="header" href="#3-vs-code-extension-configuration">3. VS Code Extension Configuration</a></h3>
<p><strong>Impact:</strong> Removed <code>perl-lsp.downloadBaseUrl</code> configuration setting</p>
<p><strong>Before (v0.8.x):</strong></p>
<pre><code class="language-json">{
  "perl-lsp.downloadBaseUrl": "https://custom-mirror.example.com/"
}
</code></pre>
<p><strong>After (v1.0):</strong></p>
<pre><code class="language-json">// Setting removed - use standard installation methods
// Install via: cargo install perl-lsp
</code></pre>
<p><strong>Action Required:</strong></p>
<ul>
<li>Remove <code>downloadBaseUrl</code> from VS Code settings</li>
<li>Use standard installation: <code>cargo install perl-lsp</code></li>
<li>Internal archive hosting no longer supported</li>
</ul>
<h3 id="4-utf-16-position-encoding"><a class="header" href="#4-utf-16-position-encoding">4. UTF-16 Position Encoding</a></h3>
<p><strong>Impact:</strong> Stricter UTF-16 compliance for LSP protocol</p>
<p><strong>Before (v0.8.x):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Mixed UTF-8 and UTF-16 positions
let position = Position { line: 0, character: offset };
<span class="boring">}</span></code></pre></pre>
<p><strong>After (v1.0):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Strict UTF-16 code unit offsets
let position = offset_to_utf16_position(source, offset)?;
<span class="boring">}</span></code></pre></pre>
<p><strong>Action Required:</strong></p>
<ul>
<li>Use provided conversion helpers for position calculations</li>
<li>Ensure all LSP positions use UTF-16 code units (not UTF-8 bytes)</li>
<li>Test with multi-byte Unicode characters</li>
</ul>
<hr />
<h2 id="new-features"><a class="header" href="#new-features">New Features</a></h2>
<h3 id="1-semantic-analyzer-pr-389-234"><a class="header" href="#1-semantic-analyzer-pr-389-234">1. Semantic Analyzer (PR #389, #234)</a></h3>
<p><strong>Complete semantic analysis pipeline with all NodeKind handlers</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use perl_parser::semantic::SemanticModel;

// Build semantic model from AST
let model = SemanticModel::build(&amp;root, source)?;

// Query symbol definitions
if let Some(def) = model.definition_at(position) {
    println!("Symbol defined at: {:?}", def.location);
}

// Access symbol table
let symbols = model.symbol_table();
for (name, symbol) in symbols {
    println!("{}: {:?}", name, symbol.kind);
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Features:</strong></p>
<ul>
<li>Complete NodeKind coverage (all AST nodes handled)</li>
<li>Precise symbol resolution across scopes</li>
<li>Package-qualified call resolution</li>
<li>Uninitialized variable detection (PR #396)</li>
<li>Type inference improvements</li>
</ul>
<p><strong>LSP Integration:</strong></p>
<ul>
<li><code>textDocument/definition</code> uses semantic analysis (not text search)</li>
<li>Improved hover information with type hints</li>
<li>Better completion context awareness</li>
</ul>
<h3 id="2-refactoring-engine-pr-387-391-392"><a class="header" href="#2-refactoring-engine-pr-387-391-392">2. Refactoring Engine (PR #387, #391, #392)</a></h3>
<p><strong>Extract Method, Inline Variable, and Move Code refactorings</strong></p>
<pre><code class="language-perl"># Before: Inline code
my $total = $price * $quantity * (1 - $discount);

# After: Extract method refactoring
sub calculate_total {
    my ($price, $quantity, $discount) = @_;
    return $price * $quantity * (1 - $discount);
}
my $total = calculate_total($price, $quantity, $discount);
</code></pre>
<p><strong>Available Refactorings:</strong></p>
<ul>
<li><strong>Extract Method</strong> (PR #315): Extract code blocks into new subroutines with parameter detection</li>
<li><strong>Inline Variable</strong> (PR #391): Inline variable definitions into usage sites</li>
<li><strong>Move Code</strong> (PR #392): Relocate code blocks within files</li>
<li><strong>Rename Symbol</strong>: Enhanced with sigil consistency validation</li>
</ul>
<p><strong>Safety Features:</strong></p>
<ul>
<li>Transactional rollback with <code>create_backup</code> (PR #298)</li>
<li>Comprehensive validation prevents invalid code generation</li>
<li>Automatic parameter detection and signature generation</li>
</ul>
<h3 id="3-tcp-socket-mode-pr-370"><a class="header" href="#3-tcp-socket-mode-pr-370">3. TCP Socket Mode (PR #370)</a></h3>
<p><strong>LSP server can now listen on TCP sockets</strong></p>
<pre><code class="language-bash"># Start LSP server on TCP port
perl-lsp --tcp 9257

# Connect from LSP client
{
  "serverConfig": {
    "host": "localhost",
    "port": 9257
  }
}
</code></pre>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Remote development workflows</li>
<li>Docker/container deployments</li>
<li>Network-based LSP clients</li>
<li>Debugging LSP communication</li>
</ul>
<h3 id="4-advanced-lsp-features"><a class="header" href="#4-advanced-lsp-features">4. Advanced LSP Features</a></h3>
<h4 id="inlay-hints-lsp-318"><a class="header" href="#inlay-hints-lsp-318">Inlay Hints (LSP 3.18)</a></h4>
<pre><code class="language-perl"># Displays parameter names and type hints inline
my $result = calculate($price, $quantity, $discount);
#                      ^^^^^^  ^^^^^^^^^  ^^^^^^^^^
#                      price:  quantity:  discount:
</code></pre>
<h4 id="call-hierarchy"><a class="header" href="#call-hierarchy">Call Hierarchy</a></h4>
<pre><code class="language-perl"># Navigate call chains
sub main {
    process_data();  # Jump to definition or find callers
}
</code></pre>
<h4 id="workspace-symbols"><a class="header" href="#workspace-symbols">Workspace Symbols</a></h4>
<pre><code class="language-bash"># Search symbols across entire workspace
# Query: "UserController"
# Results: All matching symbols in all files
</code></pre>
<h3 id="5-debug-adapter-protocol-dap---phase-1-pr-369-374-330"><a class="header" href="#5-debug-adapter-protocol-dap---phase-1-pr-369-374-330">5. Debug Adapter Protocol (DAP) - Phase 1 (PR #369, #374, #330)</a></h3>
<p><strong>Native debugger adapter with bridge mode</strong></p>
<pre><code class="language-bash"># Install DAP server
cargo install perl-dap

# Launch debugger
perl-dap --stdio

# Debug configuration (launch.json)
{
  "type": "perl",
  "request": "launch",
  "program": "${file}",
  "cwd": "${workspaceFolder}"
}
</code></pre>
<p><strong>Features:</strong></p>
<ul>
<li>Launch mode: Start new Perl process with debugging</li>
<li>Breakpoints: Set/remove breakpoints with validation</li>
<li>Step operations: Step over, step into, step out</li>
<li>Stack traces: Full call stack inspection</li>
<li>CLI argument parsing with clap (PR #374)</li>
<li>Async BridgeAdapter with graceful shutdown (PR #369)</li>
<li>Stdio transport (PR #330)</li>
</ul>
<p><strong>Limitations (Phase 1):</strong></p>
<ul>
<li>Attach mode: Not yet implemented</li>
<li>Variable inspection: Placeholder implementation</li>
<li>Expression evaluation: Limited support</li>
<li>Native adapter: Bridge to Perl::LanguageServer</li>
</ul>
<hr />
<h2 id="performance-improvements"><a class="header" href="#performance-improvements">Performance Improvements</a></h2>
<h3 id="1-o1-symbol-lookups-pr-336"><a class="header" href="#1-o1-symbol-lookups-pr-336">1. O(1) Symbol Lookups (PR #336)</a></h3>
<p><strong>Before (v0.8.x):</strong></p>
<ul>
<li>Linear scan: O(n) for symbol resolution</li>
<li>10,000 symbols: ~10ms lookup time</li>
</ul>
<p><strong>After (v1.0):</strong></p>
<ul>
<li>Hash-based lookup: O(1) for symbol resolution</li>
<li>10,000 symbols: ~50μs lookup time</li>
</ul>
<p><strong>Impact:</strong> 200x faster symbol resolution</p>
<h3 id="2-zero-allocation-variable-lookup-pr-473"><a class="header" href="#2-zero-allocation-variable-lookup-pr-473">2. Zero-Allocation Variable Lookup (PR #473)</a></h3>
<p><strong>Before (v0.8.x):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Allocated String for every lookup
let var_name = format!("${}", name);
scope.find_variable(&amp;var_name)
<span class="boring">}</span></code></pre></pre>
<p><strong>After (v1.0):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Zero allocations with Cow&lt;str&gt;
scope.find_variable_borrowed(name)
<span class="boring">}</span></code></pre></pre>
<p><strong>Impact:</strong> 50% reduction in heap allocations during scope analysis</p>
<h3 id="3-stack-based-scopeanalyzer-pr-383"><a class="header" href="#3-stack-based-scopeanalyzer-pr-383">3. Stack-Based ScopeAnalyzer (PR #383)</a></h3>
<p><strong>Before (v0.8.x):</strong></p>
<ul>
<li>Recursive parent map traversal</li>
<li>Multiple HashMap lookups per scope resolution</li>
</ul>
<p><strong>After (v1.0):</strong></p>
<ul>
<li>Stack-based ancestor tracking</li>
<li>Single traversal for scope chain</li>
</ul>
<p><strong>Impact:</strong> 3x faster scope resolution in deeply nested code</p>
<h3 id="4-reduced-string-allocations-in-parser-pr-367-372-368"><a class="header" href="#4-reduced-string-allocations-in-parser-pr-367-372-368">4. Reduced String Allocations in Parser (PR #367, #372, #368)</a></h3>
<p><strong>Before (v0.8.x):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Cloned strings for every AST node
Node::new(token.text().to_string())
<span class="boring">}</span></code></pre></pre>
<p><strong>After (v1.0):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Arc&lt;str&gt; for shared string references
Node::new(Arc::clone(&amp;token.text))
<span class="boring">}</span></code></pre></pre>
<p><strong>Impact:</strong> 40% reduction in parse time for large files</p>
<h3 id="5-built-in-function-signature-caching-pr-467"><a class="header" href="#5-built-in-function-signature-caching-pr-467">5. Built-in Function Signature Caching (PR #467)</a></h3>
<p><strong>Before (v0.8.x):</strong></p>
<ul>
<li>Rebuilt signature objects for every completion request</li>
<li>150+ function signatures reconstructed each time</li>
</ul>
<p><strong>After (v1.0):</strong></p>
<ul>
<li>Lazy static signature cache</li>
<li>One-time initialization per function</li>
</ul>
<p><strong>Impact:</strong> 10x faster completion for built-in functions</p>
<h3 id="summary-overall-performance"><a class="header" href="#summary-overall-performance">Summary: Overall Performance</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Metric</th><th>v0.8.x</th><th>v1.0</th><th>Improvement</th></tr></thead><tbody>
<tr><td>Symbol lookup (10K symbols)</td><td>~10ms</td><td>~50μs</td><td>200x</td></tr>
<tr><td>Scope resolution (deep nesting)</td><td>300μs</td><td>100μs</td><td>3x</td></tr>
<tr><td>Parser (large files)</td><td>250μs</td><td>150μs</td><td>1.7x</td></tr>
<tr><td>Built-in completion</td><td>5ms</td><td>500μs</td><td>10x</td></tr>
<tr><td>LSP test suite</td><td>60s+</td><td>&lt;10s</td><td>6x</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="security-enhancements"><a class="header" href="#security-enhancements">Security Enhancements</a></h2>
<h3 id="1-path-traversal-protection-pr-388"><a class="header" href="#1-path-traversal-protection-pr-388">1. Path Traversal Protection (PR #388)</a></h3>
<p><strong>Before (v0.8.x):</strong></p>
<pre><code class="language-perl"># Vulnerable to path traversal
executeCommand("perl", "../../../etc/passwd")
</code></pre>
<p><strong>After (v1.0):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Validates all paths before execution
let safe_path = validate_path(input)?;
if !safe_path.starts_with(workspace_root) {
    return Err(SecurityError::PathTraversal);
}
<span class="boring">}</span></code></pre></pre>
<p><strong>Protected Operations:</strong></p>
<ul>
<li><code>workspace/executeCommand</code> - All execute commands validated</li>
<li><code>perl.runCritic</code> - Path normalization and validation</li>
<li><code>perl.formatDocument</code> - Temporary file path sanitization</li>
<li><code>perl.runTests</code> - Test file path validation</li>
</ul>
<h3 id="2-command-injection-hardening-pr-332-463-475-469-466"><a class="header" href="#2-command-injection-hardening-pr-332-463-475-469-466">2. Command Injection Hardening (PR #332, #463, #475, #469, #466)</a></h3>
<p><strong>Before (v0.8.x):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Vulnerable to shell injection
Command::new("sh")
    .arg("-c")
    .arg(format!("perl {}", user_input))
<span class="boring">}</span></code></pre></pre>
<p><strong>After (v1.0):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Direct command invocation without shell
Command::new("perl")
    .arg(validated_input)
    .spawn()?
<span class="boring">}</span></code></pre></pre>
<p><strong>Hardened Components:</strong></p>
<ul>
<li>DAP <code>evaluate</code> request (PR #475) - Prevents code injection in debug expressions</li>
<li>DAP <code>launch_debugger</code> (PR #463) - Argument validation and sanitization</li>
<li><code>perlcritic</code> integration (PR #469) - Prevents argument injection</li>
<li><code>perltidy</code> integration (PR #469) - Safe argument passing</li>
<li><code>perldoc</code> lookup (PR #466) - Module name validation</li>
</ul>
<p><strong>Security Best Practices:</strong></p>
<ul>
<li>Never use shell expansion for user input</li>
<li>Validate all arguments before command execution</li>
<li>Use direct command invocation (not <code>sh -c</code>)</li>
<li>Sanitize file paths and module names</li>
</ul>
<h3 id="3-argument-injection-prevention-pr-469"><a class="header" href="#3-argument-injection-prevention-pr-469">3. Argument Injection Prevention (PR #469)</a></h3>
<p><strong>Before (v0.8.x):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Vulnerable: user input could inject flags
Command::new("perlcritic").args(user_args.split_whitespace())
<span class="boring">}</span></code></pre></pre>
<p><strong>After (v1.0):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Safe: explicit argument validation
let validated = validate_critic_args(user_args)?;
Command::new("perlcritic")
    .arg("--single-file")
    .arg(validated_file)
<span class="boring">}</span></code></pre></pre>
<p><strong>Protected Tools:</strong></p>
<ul>
<li>Perl::Critic integration</li>
<li>Perl::Tidy formatting</li>
<li>perldoc documentation</li>
<li>Test execution commands</li>
</ul>
<hr />
<h2 id="deprecated-features"><a class="header" href="#deprecated-features">Deprecated Features</a></h2>
<h3 id="1-legacy-parser-perl-parser-pest"><a class="header" href="#1-legacy-parser-perl-parser-pest">1. Legacy Parser (perl-parser-pest)</a></h3>
<p><strong>Status:</strong> Maintained but not in default gate</p>
<p><strong>Migration:</strong></p>
<pre><code class="language-toml"># Before (v0.8.x) - Pest parser
[dependencies]
perl-parser-pest = "0.8"

# After (v1.0) - Native parser (recommended)
[dependencies]
perl-parser = "1.0"
</code></pre>
<p><strong>Rationale:</strong></p>
<ul>
<li>Native parser (v3) is production-ready with ~100% syntax coverage</li>
<li>4-19x faster than Pest-based implementation</li>
<li>Better error recovery and incremental parsing</li>
</ul>
<p><strong>Timeline:</strong></p>
<ul>
<li>v1.0: Legacy parser remains available but not recommended</li>
<li>v2.0: Legacy parser may be archived or removed</li>
</ul>
<h3 id="2-internal-apis"><a class="header" href="#2-internal-apis">2. Internal APIs</a></h3>
<p><strong>Status:</strong> Semi-internal APIs marked with <code>#[doc(hidden)]</code></p>
<p><strong>Examples:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// These are now hidden from public docs
#[doc(hidden)]
pub mod positions;  // Use high-level SemanticModel instead

#[doc(hidden)]
pub mod internal_utils;  // Internal parser utilities
<span class="boring">}</span></code></pre></pre>
<p><strong>Action Required:</strong></p>
<ul>
<li>Avoid depending on <code>#[doc(hidden)]</code> APIs</li>
<li>Use public stable APIs: <code>Parser</code>, <code>SemanticModel</code>, <code>Node</code>, <code>NodeKind</code></li>
<li>File an issue if you need a hidden API made public</li>
</ul>
<hr />
<h2 id="migration-steps"><a class="header" href="#migration-steps">Migration Steps</a></h2>
<h3 id="step-1-update-dependencies"><a class="header" href="#step-1-update-dependencies">Step 1: Update Dependencies</a></h3>
<pre><code class="language-toml"># Cargo.toml - Update all perl-lsp crates
[dependencies]
perl-parser = "1.0"
perl-lexer = "1.0"
perl-lsp = "1.0"

# Update Rust edition
[package]
edition = "2024"
rust-version = "1.89"
</code></pre>
<h3 id="step-2-update-rust-toolchain"><a class="header" href="#step-2-update-rust-toolchain">Step 2: Update Rust Toolchain</a></h3>
<pre><code class="language-bash"># Install Rust 1.89+ if needed
rustup update stable

# Verify version
rustc --version  # Should show 1.89 or higher
</code></pre>
<h3 id="step-3-fix-breaking-changes"><a class="header" href="#step-3-fix-breaking-changes">Step 3: Fix Breaking Changes</a></h3>
<pre><code class="language-bash"># Run cargo check to identify breaking changes
cargo check

# Common fixes needed:
# 1. Add ? operator for Result returns
# 2. Update edition in Cargo.toml
# 3. Handle new error types
</code></pre>
<h3 id="step-4-test-your-code"><a class="header" href="#step-4-test-your-code">Step 4: Test Your Code</a></h3>
<pre><code class="language-bash"># Run full test suite
cargo test

# Run LSP tests if using LSP features
RUST_TEST_THREADS=2 cargo test -p perl-lsp

# Check for warnings
cargo clippy --workspace
</code></pre>
<h3 id="step-5-update-vs-code-extension"><a class="header" href="#step-5-update-vs-code-extension">Step 5: Update VS Code Extension</a></h3>
<pre><code class="language-bash"># Uninstall old extension
code --uninstall-extension perl-language-server

# Install new extension
code --install-extension perl-language-server@1.0.0

# Remove deprecated settings from settings.json
# Delete: "perl-lsp.downloadBaseUrl"
</code></pre>
<h3 id="step-6-update-documentation"><a class="header" href="#step-6-update-documentation">Step 6: Update Documentation</a></h3>
<pre><code class="language-bash"># Generate new documentation
cargo doc --open

# Review API changes
# Check migration guide for your specific use case
</code></pre>
<hr />
<h2 id="lsp-client-changes"><a class="header" href="#lsp-client-changes">LSP Client Changes</a></h2>
<h3 id="updated-capabilities"><a class="header" href="#updated-capabilities">Updated Capabilities</a></h3>
<p><strong>v1.0 Capability Negotiation:</strong></p>
<pre><code class="language-json">{
  "capabilities": {
    "textDocument": {
      "definition": { "dynamicRegistration": true, "linkSupport": true },
      "semanticTokens": { "requests": { "full": true, "range": true } },
      "inlayHint": { "dynamicRegistration": true },
      "codeAction": { "resolveSupport": { "properties": ["edit"] } },
      "completion": { "completionItem": { "resolveSupport": true } }
    },
    "workspace": {
      "workspaceEdit": { "documentChanges": true },
      "symbol": { "resolveProvider": true },
      "fileOperations": {
        "willRename": true,
        "didRename": true,
        "didDelete": true
      }
    }
  }
}
</code></pre>
<h3 id="new-features-available-to-clients"><a class="header" href="#new-features-available-to-clients">New Features Available to Clients</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>LSP Method</th><th>Status</th><th>Notes</th></tr></thead><tbody>
<tr><td>Semantic Definitions</td><td><code>textDocument/definition</code></td><td>Enhanced</td><td>Uses semantic analysis</td></tr>
<tr><td>Inlay Hints</td><td><code>textDocument/inlayHint</code></td><td>GA</td><td>Parameter names, type hints</td></tr>
<tr><td>Completion Resolve</td><td><code>completionItem/resolve</code></td><td>GA</td><td>Lazy documentation loading</td></tr>
<tr><td>Code Action Resolve</td><td><code>codeAction/resolve</code></td><td>GA</td><td>Deferred edit computation</td></tr>
<tr><td>Workspace Symbols</td><td><code>workspace/symbol</code></td><td>GA</td><td>Cross-file search</td></tr>
<tr><td>File Operations</td><td><code>workspace/willRename</code></td><td>GA</td><td>Refactoring support</td></tr>
<tr><td>Call Hierarchy</td><td><code>textDocument/prepareCallHierarchy</code></td><td>GA</td><td>Navigate call chains</td></tr>
</tbody></table>
</div>
<h3 id="protocol-compliance"><a class="header" href="#protocol-compliance">Protocol Compliance</a></h3>
<p><strong>v1.0 Compliance:</strong></p>
<ul>
<li><strong>LSP Coverage</strong>: 100% (53/53 advertised features)</li>
<li><strong>Protocol Compliance</strong>: 100% (88/88 including plumbing)</li>
<li><strong>LSP Version</strong>: 3.18</li>
</ul>
<p>See <a href="../features.toml">features.toml</a> for complete capability catalog.</p>
<hr />
<h2 id="library-api-changes"><a class="header" href="#library-api-changes">Library API Changes</a></h2>
<h3 id="parser-api"><a class="header" href="#parser-api">Parser API</a></h3>
<p><strong>Stable APIs (unchanged):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use perl_parser::{Parser, Node, NodeKind, ParseError};

// Core parsing API unchanged
let parser = Parser::new();
let result = parser.parse(source)?;

// AST traversal unchanged
for child in result.children() {
    match child.kind() {
        NodeKind::Subroutine =&gt; { /* handle */ },
        _ =&gt; {}
    }
}
<span class="boring">}</span></code></pre></pre>
<p><strong>New APIs (additive):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use perl_parser::semantic::SemanticModel;

// New semantic analysis API
let model = SemanticModel::build(&amp;root, source)?;
let definition = model.definition_at(byte_offset)?;
let symbols = model.symbol_table();
let hover = model.hover_info_at(position)?;
<span class="boring">}</span></code></pre></pre>
<h3 id="lexer-api"><a class="header" href="#lexer-api">Lexer API</a></h3>
<p><strong>Stable APIs (unchanged):</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use perl_lexer::{PerlLexer, Token, TokenType};

// Tokenization API unchanged
let lexer = PerlLexer::new(source);
for token in lexer {
    match token.token_type {
        TokenType::Identifier =&gt; { /* handle */ },
        _ =&gt; {}
    }
}
<span class="boring">}</span></code></pre></pre>
<h3 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h3>
<p><strong>New Result Types:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Before (v0.8.x) - could panic
let ast = parser.parse_unchecked(source);

// After (v1.0) - returns Result
let ast = parser.parse(source)
    .map_err(|e| format!("Parse error at {}: {}", e.location, e.message))?;
<span class="boring">}</span></code></pre></pre>
<p><strong>Error Types:</strong></p>
<ul>
<li><code>ParseError</code>: Parsing failures with location info</li>
<li><code>SemanticError</code>: Semantic analysis errors</li>
<li><code>RefactoringError</code>: Refactoring validation failures</li>
<li><code>SecurityError</code>: Path/command validation failures</li>
</ul>
<hr />
<h2 id="vs-code-extension-changes"><a class="header" href="#vs-code-extension-changes">VS Code Extension Changes</a></h2>
<h3 id="configuration-updates"><a class="header" href="#configuration-updates">Configuration Updates</a></h3>
<p><strong>Removed Settings:</strong></p>
<pre><code class="language-json">// REMOVED in v1.0
{
  "perl-lsp.downloadBaseUrl": "..."  // No longer supported
}
</code></pre>
<p><strong>New Settings:</strong></p>
<pre><code class="language-json">{
  // Enhanced diagnostics configuration
  "perl-lsp.diagnostics.enableUninitialized": true,

  // TCP socket mode (optional)
  "perl-lsp.server.tcp": {
    "enabled": false,
    "port": 9257
  },

  // Refactoring options
  "perl-lsp.refactoring.enableBackup": true
}
</code></pre>
<h3 id="command-palette-updates"><a class="header" href="#command-palette-updates">Command Palette Updates</a></h3>
<p><strong>New Commands:</strong></p>
<ul>
<li><strong>Perl: Extract Method</strong> - Extract selected code into subroutine</li>
<li><strong>Perl: Inline Variable</strong> - Inline variable into usage sites</li>
<li><strong>Perl: Show Call Hierarchy</strong> - Navigate call chains</li>
<li><strong>Perl: Toggle Inlay Hints</strong> - Show/hide parameter hints</li>
</ul>
<p><strong>Enhanced Commands:</strong></p>
<ul>
<li><strong>Perl: Go to Definition</strong> - Now uses semantic analysis</li>
<li><strong>Perl: Find References</strong> - Improved cross-file accuracy</li>
<li><strong>Perl: Rename Symbol</strong> - Validates sigil consistency</li>
</ul>
<h3 id="ui-improvements"><a class="header" href="#ui-improvements">UI Improvements</a></h3>
<p><strong>Product Icons (PR #384):</strong></p>
<ul>
<li>All commands now have visual icons in menus</li>
<li>Improved context menu organization</li>
<li>File-specific command filtering (PR #470)</li>
</ul>
<p><strong>Markdown Descriptions (PR #474):</strong></p>
<ul>
<li>Rich formatting in configuration descriptions</li>
<li>Code examples in setting hover tooltips</li>
<li>Better documentation links</li>
</ul>
<p><strong>Silent Startup (PR #474):</strong></p>
<ul>
<li>No notification spam on LSP server start</li>
<li>Progress indicators for long operations</li>
<li>Cleaner startup experience</li>
</ul>
<hr />
<h2 id="dap-changes"><a class="header" href="#dap-changes">DAP Changes</a></h2>
<h3 id="new-dap-server-binary"><a class="header" href="#new-dap-server-binary">New DAP Server Binary</a></h3>
<p><strong>Installation:</strong></p>
<pre><code class="language-bash"># Install DAP server separately
cargo install perl-dap

# Verify installation
perl-dap --version  # perl-dap 0.1.0
</code></pre>
<p><strong>Launch Configuration:</strong></p>
<pre><code class="language-json">{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "perl",
      "request": "launch",
      "name": "Debug Perl Script",
      "program": "${file}",
      "args": [],
      "cwd": "${workspaceFolder}",
      "stopOnEntry": false
    }
  ]
}
</code></pre>
<h3 id="dap-features-phase-1"><a class="header" href="#dap-features-phase-1">DAP Features (Phase 1)</a></h3>
<p><strong>Supported:</strong></p>
<ul>
<li>✅ Launch mode (start new process)</li>
<li>✅ Breakpoints (set/remove/list)</li>
<li>✅ Step operations (over/into/out)</li>
<li>✅ Stack traces</li>
<li>✅ Continue/pause execution</li>
<li>✅ Stdio transport (PR #330)</li>
<li>✅ CLI argument parsing (PR #374)</li>
<li>✅ Async BridgeAdapter (PR #369)</li>
</ul>
<p><strong>Not Yet Supported:</strong></p>
<ul>
<li>❌ Attach mode (connect to running process)</li>
<li>❌ Variable inspection (placeholder only)</li>
<li>❌ Expression evaluation (limited)</li>
<li>❌ Conditional breakpoints</li>
</ul>
<p><strong>Roadmap:</strong></p>
<ul>
<li>Phase 2 (planned): Attach mode, variable/evaluate work</li>
<li>Phase 3 (planned): Native adapter completeness</li>
</ul>
<hr />
<h2 id="testing-changes"><a class="header" href="#testing-changes">Testing Changes</a></h2>
<h3 id="test-infrastructure"><a class="header" href="#test-infrastructure">Test Infrastructure</a></h3>
<p><strong>Adaptive Threading (PR #140):</strong></p>
<pre><code class="language-bash"># LSP tests now support adaptive threading
RUST_TEST_THREADS=2 cargo test -p perl-lsp -- --test-threads=2

# Resource-efficient semantic tests
just ci-lsp-def
</code></pre>
<p><strong>Test Harness Improvements (PR #253, #251):</strong></p>
<ul>
<li>JSON-RPC compliance fixes</li>
<li>BrokenPipe elimination (123 tests unignored)</li>
<li>Robust cleanup and process management</li>
<li>Better timeout handling</li>
</ul>
<h3 id="test-performance"><a class="header" href="#test-performance">Test Performance</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Test Suite</th><th>v0.8.x</th><th>v1.0</th><th>Improvement</th></tr></thead><tbody>
<tr><td>LSP Behavioral Tests</td><td>1560s+</td><td>0.31s</td><td>5000x</td></tr>
<tr><td>User Story Tests</td><td>1500s+</td><td>0.32s</td><td>4700x</td></tr>
<tr><td>Workspace Tests</td><td>60s+</td><td>0.26s</td><td>230x</td></tr>
<tr><td>Overall Suite</td><td>60s+</td><td>&lt;10s</td><td>6x</td></tr>
</tbody></table>
</div>
<h3 id="running-tests"><a class="header" href="#running-tests">Running Tests</a></h3>
<pre><code class="language-bash"># All tests
cargo test --workspace

# Parser tests only
cargo test -p perl-parser

# LSP tests with threading constraints
RUST_TEST_THREADS=2 cargo test -p perl-lsp

# Semantic definition tests (resource-efficient)
just ci-lsp-def

# Full CI gate (local-first)
nix develop -c just ci-gate
</code></pre>
<hr />
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="issue-edition-2024-is-unstable-error"><a class="header" href="#issue-edition-2024-is-unstable-error">Issue: “edition ‘2024’ is unstable” Error</a></h3>
<p><strong>Problem:</strong></p>
<pre><code>error: edition '2024' is unstable and only available with -Z unstable-options
</code></pre>
<p><strong>Solution:</strong></p>
<pre><code class="language-bash"># Update Rust to 1.89+
rustup update stable

# Verify version
rustc --version  # Must be 1.89 or higher
</code></pre>
<h3 id="issue-unknown-field-downloadbaseurl-in-vs-code"><a class="header" href="#issue-unknown-field-downloadbaseurl-in-vs-code">Issue: “unknown field <code>downloadBaseUrl</code>” in VS Code</a></h3>
<p><strong>Problem:</strong></p>
<pre><code>Unknown configuration setting: perl-lsp.downloadBaseUrl
</code></pre>
<p><strong>Solution:</strong></p>
<pre><code class="language-json">// Remove from settings.json
{
  // Delete this line:
  // "perl-lsp.downloadBaseUrl": "...",
}
</code></pre>
<h3 id="issue-parser-returns-errors-instead-of-ast"><a class="header" href="#issue-parser-returns-errors-instead-of-ast">Issue: Parser Returns Errors Instead of AST</a></h3>
<p><strong>Problem:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// This now returns Result instead of panicking
let ast = parser.parse(source);  // Error: mismatched types
<span class="boring">}</span></code></pre></pre>
<p><strong>Solution:</strong></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Use ? operator for error propagation
let ast = parser.parse(source)?;

// Or handle explicitly
let ast = match parser.parse(source) {
    Ok(ast) =&gt; ast,
    Err(e) =&gt; {
        eprintln!("Parse error: {}", e);
        return;
    }
};
<span class="boring">}</span></code></pre></pre>
<h3 id="issue-lsp-tests-timeout"><a class="header" href="#issue-lsp-tests-timeout">Issue: LSP Tests Timeout</a></h3>
<p><strong>Problem:</strong></p>
<pre><code>test lsp_comprehensive_test ... timeout after 30s
</code></pre>
<p><strong>Solution:</strong></p>
<pre><code class="language-bash"># Use adaptive threading
RUST_TEST_THREADS=2 cargo test -p perl-lsp -- --test-threads=2

# Or resource-efficient mode
just ci-lsp-def
</code></pre>
<h3 id="issue-missing-symbol-lookups"><a class="header" href="#issue-missing-symbol-lookups">Issue: Missing Symbol Lookups</a></h3>
<p><strong>Problem:</strong>
Symbols defined in other files not found by go-to-definition.</p>
<p><strong>Solution:</strong></p>
<pre><code class="language-bash"># Ensure workspace indexing completes
# Check LSP server logs for indexing status

# Trigger manual re-index (VS Code)
# Command Palette: "Perl: Restart Language Server"
</code></pre>
<h3 id="issue-refactoring-fails-with-validation-error"><a class="header" href="#issue-refactoring-fails-with-validation-error">Issue: Refactoring Fails with Validation Error</a></h3>
<p><strong>Problem:</strong></p>
<pre><code>Refactoring failed: Invalid sigil in rename operation
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure symbol renames maintain sigil consistency</li>
<li>Scalar <code>$var</code> must stay scalar (can’t rename to <code>@var</code>)</li>
<li>Use LSP rename command (respects sigils)</li>
<li>Manual refactoring may bypass validation</li>
</ul>
<h3 id="issue-dap-debugger-wont-start"><a class="header" href="#issue-dap-debugger-wont-start">Issue: DAP Debugger Won’t Start</a></h3>
<p><strong>Problem:</strong></p>
<pre><code>Debug adapter executable 'perl-dap' not found
</code></pre>
<p><strong>Solution:</strong></p>
<pre><code class="language-bash"># Install DAP server separately
cargo install perl-dap

# Verify installation
which perl-dap  # Should show path

# Update launch.json if needed
{
  "debugServer": 4711,  // Or omit for stdio
}
</code></pre>
<h3 id="issue-security-validation-rejects-valid-paths"><a class="header" href="#issue-security-validation-rejects-valid-paths">Issue: Security Validation Rejects Valid Paths</a></h3>
<p><strong>Problem:</strong></p>
<pre><code>SecurityError: Path traversal attempt detected
</code></pre>
<p><strong>Solution:</strong></p>
<ul>
<li>Ensure paths are within workspace root</li>
<li>Use absolute paths resolved from workspace root</li>
<li>Avoid <code>../</code> in user-provided paths</li>
<li>Check LSP server logs for validation details</li>
</ul>
<h3 id="issue-performance-regression-after-upgrade"><a class="header" href="#issue-performance-regression-after-upgrade">Issue: Performance Regression After Upgrade</a></h3>
<p><strong>Problem:</strong>
LSP operations slower than v0.8.x</p>
<p><strong>Solution:</strong></p>
<pre><code class="language-bash"># Check if incremental parsing is enabled
# Should see fast re-parse after edits

# Verify symbol cache is working
# First lookup slow, subsequent fast

# Check server logs for performance warnings
# Look for "indexing took &gt;100ms" messages

# Report performance regression with:
# - File size
# - Operation type (completion/hover/etc)
# - LSP server logs
</code></pre>
<hr />
<h2 id="getting-help"><a class="header" href="#getting-help">Getting Help</a></h2>
<h3 id="documentation"><a class="header" href="#documentation">Documentation</a></h3>
<ul>
<li><strong>Upgrade Guide</strong>: This document</li>
<li><strong>Migration Guide</strong>: <a href="MIGRATION.html">docs/MIGRATION.md</a> (v0.7.x → v0.8.x)</li>
<li><strong>API Docs</strong>: <code>cargo doc --open</code></li>
<li><strong>LSP Status</strong>: <a href="LSP_IMPLEMENTATION_GUIDE.html">docs/LSP_IMPLEMENTATION_GUIDE.md</a></li>
<li><strong>Roadmap</strong>: <a href="ROADMAP.html">docs/ROADMAP.md</a></li>
</ul>
<h3 id="support-channels"><a class="header" href="#support-channels">Support Channels</a></h3>
<ul>
<li>
<p><strong>GitHub Issues</strong>: <a href="https://github.com/EffortlessMetrics/tree-sitter-perl-rs/issues">tree-sitter-perl-rs/issues</a></p>
<ul>
<li>Tag with <code>upgrade</code>, <code>v1.0</code>, or <code>migration</code></li>
<li>Include version numbers and error messages</li>
<li>Provide minimal reproduction if possible</li>
</ul>
</li>
<li>
<p><strong>Discussions</strong>: Use for questions, not bug reports</p>
</li>
</ul>
<h3 id="reporting-issues"><a class="header" href="#reporting-issues">Reporting Issues</a></h3>
<p>When reporting upgrade issues:</p>
<ol>
<li><strong>Version info</strong>: Include v0.8.x version and v1.0 version</li>
<li><strong>Error messages</strong>: Full error output with stack traces</li>
<li><strong>Minimal reproduction</strong>: Smallest code that shows the issue</li>
<li><strong>Platform</strong>: OS, Rust version, LSP client (if applicable)</li>
<li><strong>Steps taken</strong>: What you tried from this guide</li>
</ol>
<h3 id="example-issue-report"><a class="header" href="#example-issue-report">Example Issue Report</a></h3>
<pre><code class="language-markdown">**Title:** Parser API change breaks my code after v1.0 upgrade

**Environment:**
- perl-parser: 0.8.9 → 1.0.0
- Rust: 1.91.0
- OS: Ubuntu 22.04

**Problem:**
After upgrading to v1.0, parser.parse() now returns Result but my code expects direct AST.

**Error:**
</code></pre>
<p>error[E0308]: mismatched types
–&gt; src/main.rs:10:13
|
10 |     let ast = parser.parse(source);
|               ^^^^^^^^^^^^^^^^^^^^ expected <code>Node</code>, found <code>Result&lt;Node, ParseError&gt;</code></p>
<pre><code>
**Code:**
```rust
let parser = Parser::new();
let ast = parser.parse(source);  // This used to work
</code></pre>
<p><strong>Expected:</strong>
Clear upgrade path documented</p>
<p><strong>Actual:</strong>
Compilation error</p>
<pre><code>
---

## Summary

**v1.0 brings significant improvements:**

✅ **Semantic Analyzer**: Precise symbol resolution and type inference
✅ **Refactoring Engine**: Extract method, inline variable, move code
✅ **Performance**: 3-200x faster symbol lookups and parsing
✅ **Security**: Path traversal and command injection protection
✅ **LSP 3.18**: 100% protocol compliance, inlay hints, call hierarchy
✅ **DAP Phase 1**: Native debugger with launch/breakpoints/step
✅ **Test Infrastructure**: 5000x faster test suite, adaptive threading

**Breaking changes are minimal:**
- Rust 2024 Edition (standard upgrade path)
- Strict error handling (improves robustness)
- VS Code config cleanup (one setting removed)

**Follow the migration steps** in order, test thoroughly, and report any issues.

**Most users should experience a smooth upgrade** with significant performance and feature improvements.

---

*Last Updated: 2026-01-22*
*For latest updates, see: [CHANGELOG.md](../CHANGELOG.md)*
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../reference/stability.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../reference/error-handling-contracts.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../reference/stability.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../reference/error-handling-contracts.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
