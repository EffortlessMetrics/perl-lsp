<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DAP Protocol Schema - Perl LSP Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Comprehensive documentation for the perl-lsp project - a production-ready Perl Language Server Protocol implementation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Perl LSP Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/EffortlessMetrics/tree-sitter-perl-rs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="dap-protocol-schema-specification"><a class="header" href="#dap-protocol-schema-specification">DAP Protocol Schema Specification</a></h1>
<!-- Labels: protocol:dap, schema:json-rpc, specification:complete -->
<p><strong>Issue</strong>: #207 - Debug Adapter Protocol Support
<strong>Status</strong>: Schema Definitions Complete
<strong>Version</strong>: 1.0.0
<strong>Date</strong>: 2025-10-04</p>
<hr />
<h2 id="executive-summary"><a class="header" href="#executive-summary">Executive Summary</a></h2>
<p>This specification defines the complete JSON-RPC 2.0 message schemas for the Debug Adapter Protocol (DAP) implementation. All schemas follow the DAP 1.x specification with extensions for Perl-specific features.</p>
<p><strong>Transport</strong>: JSON-RPC 2.0 over stdio with <code>Content-Length</code> headers
<strong>Message Types</strong>: Request, Response, Event
<strong>Core Requests</strong>: 15 request types (initialize, launch, attach, breakpoints, control flow, variables, evaluate)
<strong>Events</strong>: 5 event types (initialized, stopped, continued, terminated, output)</p>
<hr />
<h2 id="1-base-protocol-types"><a class="header" href="#1-base-protocol-types">1. Base Protocol Types</a></h2>
<h3 id="11-message-transport"><a class="header" href="#11-message-transport">1.1 Message Transport</a></h3>
<pre><code class="language-typescript">// Content-Length header format
Content-Length: &lt;length&gt;\r\n
\r\n
&lt;JSON message&gt;

// Example:
Content-Length: 123\r\n
\r\n
{"seq":1,"type":"request","command":"initialize","arguments":{}}
</code></pre>
<h3 id="12-request-message"><a class="header" href="#12-request-message">1.2 Request Message</a></h3>
<pre><code class="language-json">{
  "seq": 1,
  "type": "request",
  "command": "initialize",
  "arguments": {
    // Command-specific arguments
  }
}
</code></pre>
<p><strong>JSON Schema</strong>:</p>
<pre><code class="language-json">{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DapRequest",
  "type": "object",
  "required": ["seq", "type", "command"],
  "properties": {
    "seq": {
      "type": "integer",
      "description": "Sequence number (incremented for each message)"
    },
    "type": {
      "type": "string",
      "const": "request"
    },
    "command": {
      "type": "string",
      "description": "Command name (e.g., initialize, launch, setBreakpoints)"
    },
    "arguments": {
      "type": "object",
      "description": "Command-specific arguments"
    }
  }
}
</code></pre>
<h3 id="13-response-message"><a class="header" href="#13-response-message">1.3 Response Message</a></h3>
<pre><code class="language-json">{
  "seq": 1,
  "type": "response",
  "request_seq": 1,
  "success": true,
  "command": "initialize",
  "message": "Optional error message",
  "body": {
    // Command-specific response body
  }
}
</code></pre>
<p><strong>JSON Schema</strong>:</p>
<pre><code class="language-json">{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DapResponse",
  "type": "object",
  "required": ["seq", "type", "request_seq", "success", "command"],
  "properties": {
    "seq": {
      "type": "integer"
    },
    "type": {
      "type": "string",
      "const": "response"
    },
    "request_seq": {
      "type": "integer",
      "description": "Sequence number of corresponding request"
    },
    "success": {
      "type": "boolean"
    },
    "command": {
      "type": "string"
    },
    "message": {
      "type": "string",
      "description": "Error message (if success=false)"
    },
    "body": {
      "type": "object",
      "description": "Command-specific response body"
    }
  }
}
</code></pre>
<h3 id="14-event-message"><a class="header" href="#14-event-message">1.4 Event Message</a></h3>
<pre><code class="language-json">{
  "seq": 2,
  "type": "event",
  "event": "stopped",
  "body": {
    // Event-specific body
  }
}
</code></pre>
<p><strong>JSON Schema</strong>:</p>
<pre><code class="language-json">{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DapEvent",
  "type": "object",
  "required": ["seq", "type", "event"],
  "properties": {
    "seq": {
      "type": "integer"
    },
    "type": {
      "type": "string",
      "const": "event"
    },
    "event": {
      "type": "string",
      "description": "Event name (e.g., initialized, stopped, terminated)"
    },
    "body": {
      "type": "object",
      "description": "Event-specific body"
    }
  }
}
</code></pre>
<hr />
<h2 id="2-initialization-requests"><a class="header" href="#2-initialization-requests">2. Initialization Requests</a></h2>
<h3 id="21-initialize-request"><a class="header" href="#21-initialize-request">2.1 initialize Request</a></h3>
<p><strong>Purpose</strong>: Capability negotiation between adapter and client</p>
<pre><code class="language-json">{
  "seq": 1,
  "type": "request",
  "command": "initialize",
  "arguments": {
    "clientID": "vscode",
    "clientName": "Visual Studio Code",
    "adapterID": "perl-rs",
    "locale": "en-US",
    "linesStartAt1": true,
    "columnsStartAt1": true,
    "pathFormat": "path",
    "supportsVariableType": true,
    "supportsVariablePaging": false,
    "supportsRunInTerminalRequest": false,
    "supportsMemoryReferences": false,
    "supportsProgressReporting": false,
    "supportsInvalidatedEvent": false
  }
}
</code></pre>
<p><strong>Response</strong>:</p>
<pre><code class="language-json">{
  "seq": 1,
  "type": "response",
  "request_seq": 1,
  "success": true,
  "command": "initialize",
  "body": {
    "supportsConfigurationDoneRequest": true,
    "supportsEvaluateForHovers": true,
    "supportsStepInTargetsRequest": false,
    "supportsSetVariable": false,
    "supportsConditionalBreakpoints": false,
    "supportsExceptionBreakpoints": false,
    "supportsDataBreakpoints": false,
    "supportsLogPoints": false,
    "supportsTerminateRequest": true,
    "supportsRestartRequest": false
  }
}
</code></pre>
<h3 id="22-initialized-event"><a class="header" href="#22-initialized-event">2.2 initialized Event</a></h3>
<p><strong>Purpose</strong>: Signals adapter is ready to accept configuration requests</p>
<pre><code class="language-json">{
  "seq": 2,
  "type": "event",
  "event": "initialized"
}
</code></pre>
<hr />
<h2 id="3-launchattach-requests"><a class="header" href="#3-launchattach-requests">3. Launch/Attach Requests</a></h2>
<h3 id="31-launch-request"><a class="header" href="#31-launch-request">3.1 launch Request</a></h3>
<p><strong>Purpose</strong>: Start debugging session by launching Perl script</p>
<pre><code class="language-json">{
  "seq": 3,
  "type": "request",
  "command": "launch",
  "arguments": {
    "program": "/workspace/script.pl",
    "args": ["--verbose", "input.txt"],
    "perlPath": "/usr/bin/perl",
    "includePaths": ["/workspace/lib", "/custom/lib"],
    "env": {
      "PERL5LIB": "/custom/lib",
      "DEBUG": "1"
    },
    "cwd": "/workspace",
    "stopOnEntry": false,
    "__restart": null
  }
}
</code></pre>
<p><strong>Arguments Schema</strong>:</p>
<pre><code class="language-json">{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LaunchRequestArguments",
  "type": "object",
  "required": ["program"],
  "properties": {
    "program": {
      "type": "string",
      "description": "Absolute path to Perl script to debug"
    },
    "args": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Command-line arguments passed to script"
    },
    "perlPath": {
      "type": "string",
      "default": "perl",
      "description": "Path to Perl executable"
    },
    "includePaths": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Additional @INC paths"
    },
    "env": {
      "type": "object",
      "additionalProperties": {"type": "string"},
      "description": "Environment variables"
    },
    "cwd": {
      "type": "string",
      "description": "Working directory"
    },
    "stopOnEntry": {
      "type": "boolean",
      "default": false,
      "description": "Automatically stop after launch"
    }
  }
}
</code></pre>
<p><strong>Response</strong>:</p>
<pre><code class="language-json">{
  "seq": 3,
  "type": "response",
  "request_seq": 3,
  "success": true,
  "command": "launch"
}
</code></pre>
<h3 id="32-attach-request"><a class="header" href="#32-attach-request">3.2 attach Request</a></h3>
<p><strong>Purpose</strong>: Attach to running Perl process (TCP mode)</p>
<pre><code class="language-json">{
  "seq": 4,
  "type": "request",
  "command": "attach",
  "arguments": {
    "host": "localhost",
    "port": 5000,
    "pathMapping": {
      "/workspace": "/remote/workspace"
    }
  }
}
</code></pre>
<hr />
<h2 id="4-breakpoint-requests"><a class="header" href="#4-breakpoint-requests">4. Breakpoint Requests</a></h2>
<h3 id="41-setbreakpoints-request"><a class="header" href="#41-setbreakpoints-request">4.1 setBreakpoints Request</a></h3>
<p><strong>Purpose</strong>: Set/clear breakpoints in source file</p>
<pre><code class="language-json">{
  "seq": 5,
  "type": "request",
  "command": "setBreakpoints",
  "arguments": {
    "source": {
      "path": "/workspace/lib/Module.pm",
      "name": "Module.pm"
    },
    "breakpoints": [
      {"line": 10, "column": 0},
      {"line": 25, "column": 0},
      {"line": 100, "column": 0}
    ],
    "sourceModified": false
  }
}
</code></pre>
<p><strong>Response</strong> (AC7 - Breakpoint verification):</p>
<pre><code class="language-json">{
  "seq": 5,
  "type": "response",
  "request_seq": 5,
  "success": true,
  "command": "setBreakpoints",
  "body": {
    "breakpoints": [
      {
        "id": 1,
        "verified": true,
        "line": 10,
        "column": 0
      },
      {
        "id": 2,
        "verified": true,
        "line": 25,
        "column": 0
      },
      {
        "id": 3,
        "verified": false,
        "line": 100,
        "column": 0,
        "message": "Line contains only comments"
      }
    ]
  }
}
</code></pre>
<p><strong>Breakpoint Schema</strong>:</p>
<pre><code class="language-json">{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Breakpoint",
  "type": "object",
  "required": ["id", "verified", "line"],
  "properties": {
    "id": {
      "type": "integer",
      "description": "Unique breakpoint identifier"
    },
    "verified": {
      "type": "boolean",
      "description": "Breakpoint successfully set"
    },
    "line": {
      "type": "integer",
      "description": "Actual line number (may differ from requested)"
    },
    "column": {
      "type": "integer",
      "description": "Actual column (optional)"
    },
    "message": {
      "type": "string",
      "description": "Error message if not verified"
    }
  }
}
</code></pre>
<h3 id="42-breakpoint-event"><a class="header" href="#42-breakpoint-event">4.2 breakpoint Event</a></h3>
<p><strong>Purpose</strong>: Notify client of breakpoint verification changes</p>
<pre><code class="language-json">{
  "seq": 6,
  "type": "event",
  "event": "breakpoint",
  "body": {
    "reason": "changed",
    "breakpoint": {
      "id": 1,
      "verified": true,
      "line": 10
    }
  }
}
</code></pre>
<hr />
<h2 id="5-execution-control-requests"><a class="header" href="#5-execution-control-requests">5. Execution Control Requests</a></h2>
<h3 id="51-continue-request"><a class="header" href="#51-continue-request">5.1 continue Request</a></h3>
<p><strong>Purpose</strong>: Resume execution until next breakpoint</p>
<pre><code class="language-json">{
  "seq": 7,
  "type": "request",
  "command": "continue",
  "arguments": {
    "threadId": 1
  }
}
</code></pre>
<p><strong>Response</strong> (AC9 - &lt;100ms p95 latency):</p>
<pre><code class="language-json">{
  "seq": 7,
  "type": "response",
  "request_seq": 7,
  "success": true,
  "command": "continue",
  "body": {
    "allThreadsContinued": true
  }
}
</code></pre>
<h3 id="52-next-request"><a class="header" href="#52-next-request">5.2 next Request</a></h3>
<p><strong>Purpose</strong>: Step over (execute next line)</p>
<pre><code class="language-json">{
  "seq": 8,
  "type": "request",
  "command": "next",
  "arguments": {
    "threadId": 1,
    "granularity": "line"
  }
}
</code></pre>
<h3 id="53-stepin-request"><a class="header" href="#53-stepin-request">5.3 stepIn Request</a></h3>
<p><strong>Purpose</strong>: Step into subroutine</p>
<pre><code class="language-json">{
  "seq": 9,
  "type": "request",
  "command": "stepIn",
  "arguments": {
    "threadId": 1,
    "granularity": "line"
  }
}
</code></pre>
<h3 id="54-stepout-request"><a class="header" href="#54-stepout-request">5.4 stepOut Request</a></h3>
<p><strong>Purpose</strong>: Step out of subroutine</p>
<pre><code class="language-json">{
  "seq": 10,
  "type": "request",
  "command": "stepOut",
  "arguments": {
    "threadId": 1,
    "granularity": "line"
  }
}
</code></pre>
<h3 id="55-pause-request"><a class="header" href="#55-pause-request">5.5 pause Request</a></h3>
<p><strong>Purpose</strong>: Interrupt execution</p>
<pre><code class="language-json">{
  "seq": 11,
  "type": "request",
  "command": "pause",
  "arguments": {
    "threadId": 1
  }
}
</code></pre>
<hr />
<h2 id="6-execution-state-events"><a class="header" href="#6-execution-state-events">6. Execution State Events</a></h2>
<h3 id="61-stopped-event"><a class="header" href="#61-stopped-event">6.1 stopped Event</a></h3>
<p><strong>Purpose</strong>: Notify client that execution has stopped</p>
<pre><code class="language-json">{
  "seq": 12,
  "type": "event",
  "event": "stopped",
  "body": {
    "reason": "breakpoint",
    "threadId": 1,
    "preserveFocusHint": false,
    "allThreadsStopped": true,
    "hitBreakpointIds": [1]
  }
}
</code></pre>
<p><strong>Stopped Reasons</strong>:</p>
<ul>
<li><code>"breakpoint"</code>: Hit breakpoint</li>
<li><code>"step"</code>: Step operation completed</li>
<li><code>"pause"</code>: Pause request completed</li>
<li><code>"entry"</code>: stopOnEntry launch option</li>
<li><code>"exception"</code>: Unhandled exception (future)</li>
</ul>
<h3 id="62-continued-event"><a class="header" href="#62-continued-event">6.2 continued Event</a></h3>
<p><strong>Purpose</strong>: Notify client that execution has resumed</p>
<pre><code class="language-json">{
  "seq": 13,
  "type": "event",
  "event": "continued",
  "body": {
    "threadId": 1,
    "allThreadsContinued": true
  }
}
</code></pre>
<hr />
<h2 id="7-stack-trace-requests"><a class="header" href="#7-stack-trace-requests">7. Stack Trace Requests</a></h2>
<h3 id="71-threads-request"><a class="header" href="#71-threads-request">7.1 threads Request</a></h3>
<p><strong>Purpose</strong>: Retrieve list of threads (Perl: single “Main Thread”)</p>
<pre><code class="language-json">{
  "seq": 14,
  "type": "request",
  "command": "threads"
}
</code></pre>
<p><strong>Response</strong>:</p>
<pre><code class="language-json">{
  "seq": 14,
  "type": "response",
  "request_seq": 14,
  "success": true,
  "command": "threads",
  "body": {
    "threads": [
      {
        "id": 1,
        "name": "Main Thread"
      }
    ]
  }
}
</code></pre>
<h3 id="72-stacktrace-request"><a class="header" href="#72-stacktrace-request">7.2 stackTrace Request</a></h3>
<p><strong>Purpose</strong>: Retrieve call stack (AC8)</p>
<pre><code class="language-json">{
  "seq": 15,
  "type": "request",
  "command": "stackTrace",
  "arguments": {
    "threadId": 1,
    "startFrame": 0,
    "levels": 20
  }
}
</code></pre>
<p><strong>Response</strong>:</p>
<pre><code class="language-json">{
  "seq": 15,
  "type": "response",
  "request_seq": 15,
  "success": true,
  "command": "stackTrace",
  "body": {
    "stackFrames": [
      {
        "id": 1001,
        "name": "Package::subroutine",
        "source": {
          "path": "/workspace/lib/Package.pm",
          "name": "Package.pm"
        },
        "line": 42,
        "column": 0,
        "presentationHint": "normal"
      },
      {
        "id": 1002,
        "name": "main::run",
        "source": {
          "path": "/workspace/script.pl",
          "name": "script.pl"
        },
        "line": 10,
        "column": 0,
        "presentationHint": "normal"
      }
    ],
    "totalFrames": 2
  }
}
</code></pre>
<hr />
<h2 id="8-variable-inspection-requests"><a class="header" href="#8-variable-inspection-requests">8. Variable Inspection Requests</a></h2>
<h3 id="81-scopes-request"><a class="header" href="#81-scopes-request">8.1 scopes Request</a></h3>
<p><strong>Purpose</strong>: Get variable scopes for stack frame</p>
<pre><code class="language-json">{
  "seq": 16,
  "type": "request",
  "command": "scopes",
  "arguments": {
    "frameId": 1001
  }
}
</code></pre>
<p><strong>Response</strong>:</p>
<pre><code class="language-json">{
  "seq": 16,
  "type": "response",
  "request_seq": 16,
  "success": true,
  "command": "scopes",
  "body": {
    "scopes": [
      {
        "name": "Locals",
        "variablesReference": 2001,
        "expensive": false
      },
      {
        "name": "Package",
        "variablesReference": 2002,
        "expensive": false
      }
    ]
  }
}
</code></pre>
<h3 id="82-variables-request"><a class="header" href="#82-variables-request">8.2 variables Request</a></h3>
<p><strong>Purpose</strong>: Retrieve variable values with lazy expansion (AC8)</p>
<pre><code class="language-json">{
  "seq": 17,
  "type": "request",
  "command": "variables",
  "arguments": {
    "variablesReference": 2001,
    "start": 0,
    "count": 100
  }
}
</code></pre>
<p><strong>Response</strong> (AC8 - &lt;200ms initial, &lt;100ms per child):</p>
<pre><code class="language-json">{
  "seq": 17,
  "type": "response",
  "request_seq": 17,
  "success": true,
  "command": "variables",
  "body": {
    "variables": [
      {
        "name": "$x",
        "value": "42",
        "type": "scalar",
        "variablesReference": 0
      },
      {
        "name": "@array",
        "value": "[10 items]",
        "type": "array",
        "variablesReference": 3001
      },
      {
        "name": "%hash",
        "value": "{5 keys}",
        "type": "hash",
        "variablesReference": 3002
      },
      {
        "name": "$large_scalar",
        "value": "This is a very long string that has been truncated…",
        "type": "scalar",
        "variablesReference": 0
      },
      {
        "name": "&amp;coderef",
        "value": "sub { my ($x) = @_; return $x * 2; }",
        "type": "code",
        "variablesReference": 0
      }
    ]
  }
}
</code></pre>
<p><strong>Variable Schema</strong>:</p>
<pre><code class="language-json">{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Variable",
  "type": "object",
  "required": ["name", "value", "variablesReference"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Variable name ($x, @array, %hash, &amp;coderef)"
    },
    "value": {
      "type": "string",
      "description": "Variable value (truncated to 1KB max)"
    },
    "type": {
      "type": "string",
      "enum": ["scalar", "array", "hash", "code"],
      "description": "Perl variable type"
    },
    "variablesReference": {
      "type": "integer",
      "description": "Reference for child expansion (0 = not expandable)"
    }
  }
}
</code></pre>
<hr />
<h2 id="9-evaluate-request"><a class="header" href="#9-evaluate-request">9. Evaluate Request</a></h2>
<h3 id="91-evaluate-request"><a class="header" href="#91-evaluate-request">9.1 evaluate Request</a></h3>
<p><strong>Purpose</strong>: Evaluate expression in stack frame context (AC10)</p>
<pre><code class="language-json">{
  "seq": 18,
  "type": "request",
  "command": "evaluate",
  "arguments": {
    "expression": "$x + $y",
    "frameId": 1001,
    "context": "watch",
    "allowSideEffects": false
  }
}
</code></pre>
<p><strong>Contexts</strong>:</p>
<ul>
<li><code>"watch"</code>: Watch expression</li>
<li><code>"repl"</code>: REPL console</li>
<li><code>"hover"</code>: Hover evaluation</li>
</ul>
<p><strong>Response</strong> (AC10 - Safe evaluation with timeout):</p>
<pre><code class="language-json">{
  "seq": 18,
  "type": "response",
  "request_seq": 18,
  "success": true,
  "command": "evaluate",
  "body": {
    "result": "62",
    "type": "scalar",
    "variablesReference": 0
  }
}
</code></pre>
<p><strong>Error Response</strong> (side effects without opt-in):</p>
<pre><code class="language-json">{
  "seq": 19,
  "type": "response",
  "request_seq": 19,
  "success": false,
  "command": "evaluate",
  "message": "Side effects not allowed without allowSideEffects flag",
  "body": {
    "error": {
      "id": 1002,
      "format": "Expression '{expression}' requires side effects",
      "variables": {
        "expression": "$x = 42"
      },
      "showUser": true
    }
  }
}
</code></pre>
<hr />
<h2 id="10-output-events"><a class="header" href="#10-output-events">10. Output Events</a></h2>
<h3 id="101-output-event"><a class="header" href="#101-output-event">10.1 output Event</a></h3>
<p><strong>Purpose</strong>: Send stdout/stderr/console output to client</p>
<pre><code class="language-json">{
  "seq": 20,
  "type": "event",
  "event": "output",
  "body": {
    "category": "stdout",
    "output": "Hello, world!\n",
    "source": {
      "path": "/workspace/script.pl"
    },
    "line": 5,
    "column": 0
  }
}
</code></pre>
<p><strong>Categories</strong>:</p>
<ul>
<li><code>"stdout"</code>: Standard output</li>
<li><code>"stderr"</code>: Standard error</li>
<li><code>"console"</code>: Debug console</li>
<li><code>"telemetry"</code>: Telemetry data</li>
</ul>
<hr />
<h2 id="11-session-termination"><a class="header" href="#11-session-termination">11. Session Termination</a></h2>
<h3 id="111-disconnect-request"><a class="header" href="#111-disconnect-request">11.1 disconnect Request</a></h3>
<p><strong>Purpose</strong>: Terminate debugging session</p>
<pre><code class="language-json">{
  "seq": 21,
  "type": "request",
  "command": "disconnect",
  "arguments": {
    "restart": false,
    "terminateDebuggee": true
  }
}
</code></pre>
<p><strong>Response</strong>:</p>
<pre><code class="language-json">{
  "seq": 21,
  "type": "response",
  "request_seq": 21,
  "success": true,
  "command": "disconnect"
}
</code></pre>
<h3 id="112-terminated-event"><a class="header" href="#112-terminated-event">11.2 terminated Event</a></h3>
<p><strong>Purpose</strong>: Notify client that debuggee has terminated</p>
<pre><code class="language-json">{
  "seq": 22,
  "type": "event",
  "event": "terminated",
  "body": {
    "restart": false
  }
}
</code></pre>
<hr />
<h2 id="12-error-handling"><a class="header" href="#12-error-handling">12. Error Handling</a></h2>
<h3 id="121-error-response-format"><a class="header" href="#121-error-response-format">12.1 Error Response Format</a></h3>
<pre><code class="language-json">{
  "seq": 23,
  "type": "response",
  "request_seq": 23,
  "success": false,
  "command": "setBreakpoints",
  "message": "Path traversal detected in breakpoint path",
  "body": {
    "error": {
      "id": 1001,
      "format": "Security violation: attempted path traversal in '{path}'",
      "variables": {
        "path": "/workspace/../../../etc/passwd"
      },
      "showUser": true,
      "sendTelemetry": false
    }
  }
}
</code></pre>
<h3 id="122-error-ids-ac16---security-validation"><a class="header" href="#122-error-ids-ac16---security-validation">12.2 Error IDs (AC16 - Security validation)</a></h3>
<div class="table-wrapper"><table><thead><tr><th>ID</th><th>Category</th><th>Description</th></tr></thead><tbody>
<tr><td>1001</td><td>Security</td><td>Path traversal attempt</td></tr>
<tr><td>1002</td><td>Security</td><td>Side effects not allowed</td></tr>
<tr><td>1003</td><td>Security</td><td>Evaluation timeout (&gt;5s)</td></tr>
<tr><td>1004</td><td>Protocol</td><td>Invalid request format</td></tr>
<tr><td>1005</td><td>Protocol</td><td>Unknown command</td></tr>
<tr><td>1006</td><td>Runtime</td><td>Debuggee terminated</td></tr>
<tr><td>1007</td><td>Runtime</td><td>Breakpoint verification failed</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="13-perl-specific-extensions"><a class="header" href="#13-perl-specific-extensions">13. Perl-Specific Extensions</a></h2>
<h3 id="131-perl-variable-types"><a class="header" href="#131-perl-variable-types">13.1 Perl Variable Types</a></h3>
<p><strong>Standard Perl Sigils</strong>:</p>
<ul>
<li><code>$scalar</code>: Scalar variable</li>
<li><code>@array</code>: Array variable</li>
<li><code>%hash</code>: Hash variable</li>
<li><code>&amp;coderef</code>: Subroutine reference</li>
<li><code>*typeglob</code>: Typeglob (not expanded by default)</li>
</ul>
<h3 id="132-variable-rendering-rules"><a class="header" href="#132-variable-rendering-rules">13.2 Variable Rendering Rules</a></h3>
<p><strong>Truncation</strong> (AC8):</p>
<ul>
<li>Scalars: 1KB max with <code>…</code> suffix</li>
<li>Arrays: <code>[N items]</code> summary, lazy child expansion</li>
<li>Hashes: <code>{N keys}</code> summary, lazy child expansion</li>
<li>Coderefs: B::Deparse representation</li>
</ul>
<p><strong>Unicode Safety</strong> (AC16):</p>
<ul>
<li>UTF-16 boundary validation (PR #153 infrastructure)</li>
<li>Emoji and multi-byte character support</li>
</ul>
<h3 id="133-breakpoint-validation-ac7"><a class="header" href="#133-breakpoint-validation-ac7">13.3 Breakpoint Validation (AC7)</a></h3>
<p><strong>Invalid Breakpoint Locations</strong>:</p>
<ul>
<li>Comment-only lines</li>
<li>Blank lines</li>
<li>Inside heredocs</li>
<li>Inside POD documentation</li>
<li>Inside string literals</li>
</ul>
<p><strong>Adjustment Strategy</strong>:</p>
<ul>
<li>Search forward (max 5 lines) for executable code</li>
<li>Return adjusted line number in verification response</li>
</ul>
<hr />
<h2 id="14-references"><a class="header" href="#14-references">14. References</a></h2>
<ul>
<li><a href="https://microsoft.github.io/debug-adapter-protocol/">Debug Adapter Protocol Specification</a></li>
<li><a href="https://www.jsonrpc.org/specification">JSON-RPC 2.0 Specification</a></li>
<li><a href="DAP_IMPLEMENTATION_SPECIFICATION.html">DAP Implementation Specification</a></li>
<li><a href="CRATE_ARCHITECTURE_DAP.html">DAP Crate Architecture</a></li>
<li><a href="DAP_SECURITY_SPECIFICATION.html">DAP Security Specification</a></li>
</ul>
<hr />
<p><strong>End of DAP Protocol Schema Specification</strong></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../dap/bridge-setup.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../ci/overview.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../dap/bridge-setup.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../ci/overview.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
