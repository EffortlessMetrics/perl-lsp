==================
Vec operations
==================
# @id: vec_bitwise_dbm.001
# @tags: bitwise dbm tie vec
# @perl: 5.8+


vec($bits, 0, 8) = 255;
vec($bits, 1, 8) = 128;
my $byte = vec($bits, 0, 8);
vec($v, 3, 4) = 0xF;
vec($string, 7, 1) = 1;
for (my $i = 0; $i < 8; $i++) {
    vec($byte_array, $i, 8) = $i * 16;
}

---

(source_file
  (expression_statement (assignment_expression (call_expression (identifier) (argument_list (variable) (number) (number))) (number)))
  (expression_statement (assignment_expression (call_expression (identifier) (argument_list (variable) (number) (number))) (number)))
  (expression_statement (my_declaration (variable) (call_expression (identifier) (argument_list (variable) (number) (number)))))
  (expression_statement (assignment_expression (call_expression (identifier) (argument_list (variable) (number) (number))) (number)))
  (expression_statement (assignment_expression (call_expression (identifier) (argument_list (variable) (number) (number))) (number)))
  (for_statement 
    (parenthesized_expression 
      (my_declaration (variable) (number))
      (binary_expression (variable) (number))
      (postfix_expression (variable)))
    (block (expression_statement (assignment_expression 
      (call_expression (identifier) (argument_list (variable) (variable) (number)))
      (binary_expression (variable) (number)))))))

==================
Bitwise operators
==================
# @id: vec_bitwise_dbm.002
# @tags: bitwise dbm tie vec
# @perl: 5.8+


my $and = $a & $b;
my $or = $a | $b;
my $xor = $a ^ $b;
my $not = ~$a;
my $lshift = $x << 2;
my $rshift = $x >> 1;
$flags &= ~0x10;
$flags |= 0x20;
$flags ^= 0x40;

---

(source_file
  (expression_statement (my_declaration (variable) (binary_expression (variable) (variable))))
  (expression_statement (my_declaration (variable) (binary_expression (variable) (variable))))
  (expression_statement (my_declaration (variable) (binary_expression (variable) (variable))))
  (expression_statement (my_declaration (variable) (unary_expression (variable))))
  (expression_statement (my_declaration (variable) (binary_expression (variable) (number))))
  (expression_statement (my_declaration (variable) (binary_expression (variable) (number))))
  (expression_statement (assignment_expression (variable) (unary_expression (number))))
  (expression_statement (assignment_expression (variable) (number)))
  (expression_statement (assignment_expression (variable) (number))))

==================
String bitwise operators
==================
# @id: vec_bitwise_dbm.003
# @tags: bitwise dbm string tie vec
# @perl: 5.8+


my $str_and = "abc" & "xyz";
my $str_or = "abc" | "xyz";
my $str_xor = "abc" ^ "xyz";
my $str_not = ~"abc";
use feature 'bitwise';
my $num_and = $x &. $y;
my $str_and2 = $s &. $t;

---

(source_file
  (expression_statement (my_declaration (variable) (binary_expression (string) (string))))
  (expression_statement (my_declaration (variable) (binary_expression (string) (string))))
  (expression_statement (my_declaration (variable) (binary_expression (string) (string))))
  (expression_statement (my_declaration (variable) (unary_expression (string))))
  (use_statement (identifier) (string))
  (expression_statement (my_declaration (variable) (binary_expression (variable) (variable))))
  (expression_statement (my_declaration (variable) (binary_expression (variable) (variable)))))

==================
DBM operations
==================
# @id: vec_bitwise_dbm.004
# @tags: bitwise dbm tie vec
# @perl: 5.8+


dbmopen(%db, "mydb", 0644) or die "Can't open database: $!";
$db{key} = "value";
my $val = $db{key};
delete $db{old_key};
exists $db{key};
keys %db;
dbmclose(%db);

---

(source_file
  (expression_statement (binary_expression 
    (call_expression (identifier) (argument_list (variable) (string) (number)))
    (call_expression (identifier) (string))))
  (expression_statement (assignment_expression (hash_element (variable) (identifier)) (string)))
  (expression_statement (my_declaration (variable) (hash_element (variable) (identifier))))
  (expression_statement (call_expression (identifier) (hash_element (variable) (identifier))))
  (expression_statement (call_expression (identifier) (hash_element (variable) (identifier))))
  (expression_statement (call_expression (identifier) (variable)))
  (expression_statement (call_expression (identifier) (argument_list (variable)))))

==================
Select and file operations
==================
# @id: vec_bitwise_dbm.005
# @tags: bitwise dbm file-test tie vec
# @perl: 5.8+


select((select(FH), $| = 1)[0]);
select(STDOUT);
my $old = select(STDERR);
select(undef, undef, undef, 0.25);
fcntl(FH, F_SETFL, O_NONBLOCK);
ioctl(FH, TIOCGWINSZ, $winsize);

---

(source_file
  (expression_statement (call_expression (identifier) (argument_list (array_element (parenthesized_expression 
    (list 
      (call_expression (identifier) (argument_list (identifier)))
      (assignment_expression (special_variable) (number))))
    (number)))))
  (expression_statement (call_expression (identifier) (argument_list (identifier))))
  (expression_statement (my_declaration (variable) (call_expression (identifier) (argument_list (identifier)))))
  (expression_statement (call_expression (identifier) (argument_list (undef) (undef) (undef) (number))))
  (expression_statement (call_expression (identifier) (argument_list (identifier) (identifier) (identifier))))
  (expression_statement (call_expression (identifier) (argument_list (identifier) (identifier) (variable)))))

==================
Sysread and syswrite
==================
# @id: vec_bitwise_dbm.006
# @tags: bitwise dbm tie vec
# @perl: 5.8+


sysread(FH, $buffer, 1024);
sysread(FH, $buffer, 1024, $offset);
syswrite(FH, $data);
syswrite(FH, $data, length($data));
syswrite(FH, $data, $length, $offset);
sysseek(FH, 0, SEEK_SET);

---

(source_file
  (expression_statement (call_expression (identifier) (argument_list (identifier) (variable) (number))))
  (expression_statement (call_expression (identifier) (argument_list (identifier) (variable) (number) (variable))))
  (expression_statement (call_expression (identifier) (argument_list (identifier) (variable))))
  (expression_statement (call_expression (identifier) (argument_list (identifier) (variable) (call_expression (identifier) (argument_list (variable))))))
  (expression_statement (call_expression (identifier) (argument_list (identifier) (variable) (variable) (variable))))
  (expression_statement (call_expression (identifier) (argument_list (identifier) (number) (identifier)))))

==================
Pack bits
==================
# @id: vec_bitwise_dbm.007
# @tags: bitwise dbm tie vec
# @perl: 5.8+


my $packed = pack("b*", "10101010");
my $bits = unpack("b*", $packed);
my $hex = unpack("H*", $data);
my $binary = pack("B*", "01010101");

---

(source_file
  (expression_statement (my_declaration (variable) (call_expression (identifier) (argument_list (string) (string)))))
  (expression_statement (my_declaration (variable) (call_expression (identifier) (argument_list (string) (variable)))))
  (expression_statement (my_declaration (variable) (call_expression (identifier) (argument_list (string) (variable)))))
  (expression_statement (my_declaration (variable) (call_expression (identifier) (argument_list (string) (string))))))
