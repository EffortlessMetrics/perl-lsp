==================
Dynamic regex eval
==================

/(??{ $pattern })/;

my $depth = qr/\( (?: [^()]++ | (??{ $depth }) )* \)/x;

/^(??{ $regex_var })$/;

s/(.)/$replace{$1} || (??{ quotemeta($1) })/ge;

my $balanced = qr{
    \{
        (?:
            [^{}]+
            |
            (??{ $balanced })
        )*
    \}
}x;

---

(source_file
  (statement)
  (statement)
  (statement)
  (statement)
  (statement))

==================
Atomic groups
==================

/(?>pattern)/;
/(?>a*)/;
/(?>a+b+)/;

/\b(?>integer|insert|in)\b/;

/"(?>[^"\\]+|\\.)*"/;

/(?>(?:a|ab|abc)+)/;

---

(source_file
  (statement)
  (statement)
  (statement)
  (statement)
  (statement)
  (statement))

==================
Branch reset groups
==================

/(?|foo(\d+)|bar(\w+)|baz(\S+))/;

/(?|(a)(b)|(c)(d))/;

/(?|<(\w+)>|\[(\w+)\]|\{(\w+)\})/;

if (/(?|"([^"]*)"|'([^']*)'|([^"'\s]+))/) {
    print "Captured: $1\n";
}

---

(source_file
  (statement)
  (statement)
  (statement)
  (if_statement))

==================
Control verb SKIP
==================

/a(*SKIP)b|ab/;

/\w+(*SKIP)(?{ print "Skipping $&\n" })|./;

/foo(*SKIP)bar|foo/;

/(*SKIP:label)pattern/;

---

(source_file
  (statement)
  (statement)
  (statement)
  (statement))

==================
Control verb FAIL
==================

/pattern(*FAIL)/;

/foo(*FAIL)|bar/;

/\d{3}(*FAIL)|.*/;

/(*FAIL:name)/;

---

(source_file
  (statement)
  (statement)
  (statement)
  (statement))

==================
Control verb PRUNE
==================

/a+(*PRUNE)b/;

/pattern(*PRUNE)/;

/foo(*PRUNE)bar|baz/;

/(*PRUNE:label)/;

---

(source_file
  (statement)
  (statement)
  (statement)
  (statement))

==================
Control verb COMMIT
==================

/a+(*COMMIT)b/;

/pattern(*COMMIT)rest/;

/foo(*COMMIT)bar|alternative/;

/(*COMMIT:name)/;

---

(source_file
  (statement)
  (statement)
  (statement)
  (statement))

==================
Control verb MARK
==================

/(*MARK:A)foo(*SKIP:A)bar/;

/(*MARK:START)pattern(*MARK:END)/;

/(*:label)pattern/;

/foo(*MARK:X)bar(*SKIP:X)baz/;

---

(source_file
  (statement)
  (statement)
  (statement)
  (statement))

==================
Control verb ACCEPT
==================

/pattern(*ACCEPT)/;

/foo(*ACCEPT)never_reached/;

/a+(*ACCEPT)b/;

---

(source_file
  (statement)
  (statement)
  (statement))

==================
Control verb THEN
==================

/A(*THEN)B|C/;

/(foo|bar)(*THEN)baz/;

/pattern(*THEN)rest|alternative/;

---

(source_file
  (statement)
  (statement)
  (statement))

==================
Multiple control verbs
==================

/foo(*PRUNE)(*SKIP)bar/;

/(*MARK:A)pattern(*SKIP:A)(*FAIL)/;

/a(*COMMIT)b(*PRUNE)c/;

/start(*MARK:X)middle(*SKIP:X)end(*FAIL)/;

---

(source_file
  (statement)
  (statement)
  (statement)
  (statement))

==================
Re pragma with code blocks
==================

use re 'eval';

/(?{ $x = 1 })/;
/(??{ $pattern })/;

no re 'eval';

{
    use re 'eval';
    /(?{ local $count = 0 })(\w+)(?{ $count++ })/;
}

use re qw(eval debug);
/complex(?{ print "here\n" })pattern/;

---

(source_file
  (use_statement)
  (statement)
  (statement)
  (no_statement)
  (block)
  (use_statement)
  (statement))