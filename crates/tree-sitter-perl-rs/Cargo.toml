[package]
name = "tree-sitter-perl"
rust-version = "1.89"
version = "0.8.3"
edition = "2024"
description = "Tree-sitter Perl validation harness (internal only)"
publish = false
license = "Apache-2.0 OR MIT"
repository = "https://github.com/EffortlessMetrics/tree-sitter-perl"
keywords = ["tree-sitter", "perl", "parser", "grammar"]
categories = ["parsing", "text-processing"]

[dependencies]
perl-lexer = { path = "../perl-lexer" }
perl-parser = { path = "../perl-parser" }
perl-parser-pest = { path = "../perl-parser-pest", optional = true }
tree-sitter = "0.26.3"
serde = { version = "1.0.228", features = ["derive"] }
bincode = { version = "2.0.0-rc.3", features = ["serde"] }
proptest = "1.9.0"
walkdir = "2.5.0"
thiserror = "2.0.17"
unicode-ident = "1.0.22"
unicode-normalization = "0.1.25"
pest = "2.8.4"
pest_derive = "2.8.4"
logos = "0.16.0"
chumsky = "0.12.0"
regex = "1.12.2"
anyhow = "1.0.100"
stacker = "0.1.22"
encoding_rs = "0.8.35"
serde_json = "1.0.148"
once_cell = "1.21.3"
lazy_static = "1.5.0"
clap = { version = "4.5.53", features = ["derive"] }
chrono = { version = "0.4.42", features = ["serde"] }
perl-tdd-support = { path = "../perl-tdd-support" }

[dev-dependencies]
criterion = "0.8.1"
test-case = "3.3.1"

[lints.rust]
unused_imports = "warn"
dead_code = "warn"

[lints.clippy]
collapsible_if = "warn"
manual_strip = "warn"
unnecessary_map_or = "warn"
redundant_closure = "warn"
while_let_on_iterator = "warn"
len_zero = "warn"
only_used_in_recursion = "warn"
ptr_arg = "warn"

[features]
default = ["pure-rust", "v2-pest-microcrate"]
pure-rust = []
# Source v2 Pest modules from perl-parser-pest microcrate (enabled by default).
v2-pest-microcrate = ["dep:perl-parser-pest"]
bindings = ["dep:bindgen"]
c-parser = ["dep:cc"]
pure-rust-standalone = ["pure-rust"]  # For benchmarking without perl-lexer
token-parser = []
test-utils = []
# Legacy features (for benchmarking only)
c-scanner = []
rust-scanner = []
# Aspirational test features - enable when implementing these capabilities
modern-perl-syntax = []  # Subroutine signatures, postfix deref, state variables
heredoc-advanced = []    # Complex heredoc features (delimiters, interpolation, recovery)
stress-tests = []        # Stack overflow and stress tests

[lib]
name = "tree_sitter_perl"
path = "src/lib.rs"

[[bin]]
name = "bench_parser"
path = "src/bin/bench_parser.rs"
required-features = ["test-utils"]

[[bin]]
name = "compare_parsers"
path = "src/bin/compare_parsers.rs"
required-features = ["test-utils"]

[[bin]]
name = "test_stacker"
path = "src/bin/test_stacker.rs"
required-features = ["pure-rust"]

[[bin]]
name = "ts_benchmark_parsers"
path = "src/bin/benchmark_parsers.rs"
required-features = ["pure-rust"]

[[bin]]
name = "ts_test_parsers"
path = "src/bin/test_parsers.rs"
required-features = ["pure-rust"]

[[bin]]
name = "ts-parse-rust"
path = "src/bin/parse_rust.rs"
required-features = ["pure-rust"]

[[example]]
name = "showcase_features"
path = "examples/showcase_features.rs"
required-features = ["pure-rust"]

[[example]]
name = "final_demo"
path = "examples/final_demo.rs"
required-features = ["pure-rust"]

[[example]]
name = "advanced_features"
path = "examples/advanced_features.rs"
required-features = ["pure-rust"]

[[example]]
name = "comprehensive_demo"
path = "examples/comprehensive_demo.rs"
required-features = ["pure-rust"]

[[example]]
name = "edge_case_tests"
path = "examples/edge_case_tests.rs"
required-features = ["pure-rust"]

[[example]]
name = "supported_edge_cases"
path = "examples/supported_edge_cases.rs"
required-features = ["pure-rust"]

[[example]]
name = "heredoc_edge_cases"
path = "examples/heredoc_edge_cases.rs"
required-features = ["pure-rust"]

[[example]]
name = "debug_heredoc"
path = "examples/debug_heredoc.rs"
required-features = ["pure-rust"]

[[example]]
name = "test_code_ref"
path = "examples/test_code_ref.rs"
required-features = ["pure-rust"]

[[example]]
name = "test_for_loop"
path = "examples/test_for_loop.rs"
required-features = ["pure-rust"]

[[example]]
name = "test_qq_operators"
path = "examples/test_qq_operators.rs"
required-features = ["pure-rust"]

[[example]]
name = "test_qq_edge_case"
path = "examples/test_qq_edge_case.rs"
required-features = ["pure-rust"]

[[example]]
name = "test_regex_delimiters"
path = "examples/test_regex_delimiters.rs"
required-features = ["pure-rust"]

[[example]]
name = "test_indirect_object"
path = "examples/test_indirect_object.rs"
required-features = ["pure-rust"]


[[bench]]
name = "scanner_benchmarks"
path = "../../benches/scanner_benchmarks.rs"
harness = false

[[bench]]
name = "parser_benchmarks"
path = "../../benches/parser_benchmarks.rs"
harness = false

[[bench]]
name = "edge_case_benchmarks"
path = "../../benches/edge_case_benchmarks.rs"
harness = false

[build-dependencies]
cc = { version = "1.2.51", optional = true }
bindgen = { version = "0.72.1", optional = true } 
